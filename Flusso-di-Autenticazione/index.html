<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Flusso di Autenticazione - TestDaris</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.5.3, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">

<nav role="navigation">
<ul class="summary">
<li>
<a href=".." target="_blank" class="custom-link">TestDaris</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="..">Home</a>
<li class="chapter" data-path="Documentazione-tecnica/">
<a href="../Documentazione-tecnica/"> </a>
<li class="chapter" data-path="FAQ/">
<a href="../FAQ/">FAQ (Frequently Asked Questions)</a>
<li class="chapter active" data-path="Flusso-di-Autenticazione/">
<a href="./">Flusso di Autenticazione</a>
<li class="chapter" data-path="Home/">
<a href="../Home/">Home</a>
<li class="chapter" data-path="Index/">
<a href="../Index/">Index</a>
<li class="chapter" data-path="Integrazione-C%23-Core/">
<a href="../Integrazione-C%23-Core/">Integrazione C# Core</a>
<li class="chapter" data-path="Integrazione-Classe-C%23/">
<a href="../Integrazione-Classe-C%23/">Integrazione classe C</a>
<li class="chapter" data-path="Integrazione-Servlet-Java/">
<a href="../Integrazione-Servlet-Java/">Integrazione mediante servlet Java</a>
<li class="chapter" data-path="Parametri-della-Richiesta-di-Autenticazione/">
<a href="../Parametri-della-Richiesta-di-Autenticazione/">Parametri della Richiesta di Autenticazione</a>
<li class="chapter" data-path="Per-PA-e-Imprese/">
<a href="../Per-PA-e-Imprese/">Per PA e Imprese</a>
<li class="chapter" data-path="Pubbliche-Amministrazioni-e-Imprese/">
<a href="../Pubbliche-Amministrazioni-e-Imprese/">Come integro CohesionID?</a>
<li class="chapter" data-path="Rinnovo-del-Token/">
<a href="../Rinnovo-del-Token/">Come rinnovare il Token</a>
<li class="chapter" data-path="_Footer/">
<a href="../_Footer/"> Footer</a>
<li class="chapter" data-path="_Sidebar/">
<a href="../_Sidebar/"> Sidebar</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">

<section class="normal markdown-section">



<h1 id="flusso-di-autenticazione">Flusso di Autenticazione</h1>
<h2 id="1-lutente-richiede-di-effettuare-il-login">1. L'utente richiede di effettuare il login</h2>
<p>L'utente desidera effettuare l'accesso ad un'applicazione che integra il sistema Cohesion, cliccando sul <em>login</em> viene reindirizzato al sistema Cohesion ID.</p>
<h2 id="2-lutente-sceglie-lidp">2. L'utente sceglie l'IdP</h2>
<p>L'utente seleziona l'<em>Identity Provider</em> per effettuare la procedura di riconoscimento. 
Cohesion genera una richiesta di accesso in cui ottiene il <strong>Codice Fiscale</strong> e l'<strong>ID Sessione</strong> dell'utente.</p>
<h2 id="3-accesso-allapplicativo">3. Accesso all'applicativo</h2>
<p>Cohesion effettua una seconda chiamata al fine ottenere gli attributi dell'utente recuperati dall'Identity Provider scelto dall'utente.</p>
<p>L'utente viene reindirizzato all'applicazione con un <em>token proprietario</em>, contente gli attributi necessari all'accesso.</p>
<h1 id="auth-request">Auth Request</h1>
<p>Per accedere ai servizi offerti da CohesionID, è necessario effettuare una chiamata in GET all'indirizzo <a href="https://colab.research.google.com/corgiredirector?site=https%3A%2F%2Fcohesion2.regione.marche.it%2FSPManager%2FWAYF.aspx">https://cohesion2.regione.marche.it/SPManager/WAYF.aspx</a> con un parametro <em>AUTH</em> contenente dei parametri di autenticazione come quelli dell'esempio in basso.</p>
<p>Il chiamante, in questo esempio, sarà <em>example.cohesion.it</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="nt">&lt;dsAuth</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://tempuri.org/Auth.xsd&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;auth&gt;</span>
<span class="w">        </span><span class="nt">&lt;user/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sito&gt;</span>ID<span class="w"> </span>SITO<span class="w"> </span>ASSEGNATO<span class="nt">&lt;/id_sito&gt;</span>
<span class="w">        </span><span class="nt">&lt;esito_auth_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_aspnet_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;url_validate&gt;</span>https://example.cohesion.it/cohesionAuthCallback<span class="nt">&lt;/url_validate&gt;</span>
<span class="w">        </span><span class="nt">&lt;url_richiesta&gt;</span>https://example.cohesion.it:443/cohesionErrorCallback<span class="nt">&lt;/url_richiesta&gt;</span>
<span class="w">        </span><span class="nt">&lt;esito_auth_sso/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_sso/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_aspnet_sso/&gt;</span>
<span class="w">        </span><span class="nt">&lt;stilesheet&gt;</span>AuthRestriction=1,2,3<span class="nt">&lt;/stilesheet&gt;</span>
<span class="w">    </span><span class="nt">&lt;/auth&gt;</span>
<span class="nt">&lt;/dsAuth&gt;</span>
</code></pre></div>

<p>In particolare:
* <strong>id_sito</strong>: è l'identificativo assegnato all'integrazione specifica con Cohesion. Ogni sito ha un id_sito differente e univoco
* <strong>url_validate</strong>: contiente l'URL al quale Cohesion reindirizza i dati ottenuti dall'Identity Provider utilizzato (Poste, Namirial, Cohesion, ecc...) dopo la login
* <strong>url_richieste</strong>: contiene l'URL della pagina a cui tornare in caso di errori di autenticazione
* <strong>stilesheet</strong>: contiente (opzionalmente) l'URL al quale Cohesion fa il <strong>redirect</strong> dopo aver eseguito la cancellazione della sessione in seguito ad una richiesta di logout. Contiene anche eventuali restrizioni sul livello di autenticazione richiesto (SPID livello 1, 2 o 3). Per specificare il livello di autenticazione è sufficiente inserire il parametro <code>&lt;AuthRestriction=1,2,3&gt;</code> indicando il numero del livello minimo accettabile (per accettare ogni tipo di autenticazione, impostare il parametro con 0,1,2,3)</p>
<p>Esempio:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="nt">&lt;dsAuth</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://tempuri.org/Auth.xsd&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;auth&gt;</span>
<span class="w">        </span><span class="nt">&lt;user/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sito&gt;</span>COHESION_EXAMPLE<span class="nt">&lt;/id_sito&gt;</span>
<span class="w">        </span><span class="nt">&lt;esito_auth_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_aspnet_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;url_validate&gt;</span>https://example.cohesion.it/Login<span class="nt">&lt;/url_validate&gt;</span>
<span class="w">        </span><span class="nt">&lt;url_richiesta&gt;</span>https://example.cohesion.it<span class="nt">&lt;/url_richiesta&gt;</span>
<span class="w">        </span><span class="nt">&lt;esito_auth_sso/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_sso/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_aspnet_sso/&gt;</span>
<span class="w">        </span><span class="nt">&lt;stilesheet&gt;</span>AuthRestriction=2,3;https://example.cohesion.it/LogOff<span class="nt">&lt;/stilesheet&gt;</span>
<span class="w">    </span><span class="nt">&lt;/auth&gt;</span>
<span class="nt">&lt;/dsAuth&gt;</span>
</code></pre></div>

<p>In questo esempio, diciamo a Cohesion che:
* vogliamo che il token di autenticazione venga inoltrato in POST (per default) all'indirizzo https://example.cohesion.it/Login
* vogliamo che, una volta fatto il logout, Cohesion reindirizzi all'URL https://example.cohesion.it/LogOff
* il livello di autenticazione minimo accettabile è il 2 (Codice fiscale + password + PIN se l'IdP è Cohesion oppure SPID livello 2 negli altri casi).
* se ci sono errori, vogliamo che Cohesion torni alla homepage https://example.cohesion.it</p>
<p>L'XML contenuto nel parametro auth deve essere codificato in <strong>base64</strong> e poi con <strong>URL Encode</strong>. Un esempio di prodotto finale ha questa forma:</p>
<div class="codehilite"><pre><span></span><code>PD94bWwgdmVyc2lvbj0iMS4wIiA%2FPg0KPGRzQXV0aCB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4bWxucz0iaHR0cDovL3RlbXB1cmkub3JnL0F1dGgueHNkIj4NCgk8YXV0aD4NCgkJPHVzZXIvPg0KCQk8aWRfc2EvPg0KCQk8aWRfc2l0bz5leGFtcGxlPC9pZF9zaXRvPg0KCQk8ZXNpdG9fYXV0aF9zYS8+DQoJCTxpZF9zZXNzaW9uZV9zYS8+DQoJCTxpZF9zZXNzaW9uZV9hc3BuZXRfc2EvPg0KCQk8dXJsX3ZhbGlkYXRlPmh0dHBzOi8vZXhhbXBsZS5jb2hlc2lvbi5pdC9Mb2dpbjwvdXJsX3ZhbGlkYXRlPg0KCQk8dXJsX3JpY2hpZXN0YT5odHRwczovL2V4YW1wbGUuY29oZXNpb24uaXQ8L3VybF9yaWNoaWVzdGE+DQoJCTxlc2l0b19hdXRoX3Nzby8+DQoJCTxpZF9zZXNzaW9uZV9zc28vPg0KCQk8aWRfc2Vzc2lvbmVfYXNwbmV0X3Nzby8+DQoJCTxzdGlsZXNoZWV0PkF1dGhSZXN0cmljdGlvbj0yLDM7aHR0cHM6Ly9leGFtcGxlLmNvaGVzaW9uLml0L0xvZ09mZjwvc3RpbGVzaGVldD4NCgk8L2F1dGg+DQo8L2RzQXV0aD4
</code></pre></div>

<h1 id="cosa-contiene-il-token-cohesion-dopo-lautenticazione">Cosa contiene il token Cohesion dopo l'autenticazione?</h1>
<p>Dopo l'autenticazione dell'utente, Cohesion effettua una chiamata <strong>POST</strong> all'indirizzo specificato in <strong>url_validate</strong> nel cui body verrà specificato un token di autenticazione. 
Nel body ci sarà un elemento <em>auth</em> codificato in base64 e URL Encoded che conterrà un XML di questo tipo:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="nt">&lt;dsAuth</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://tempuri.org/Auth.xsd&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;auth&gt;</span>
<span class="w">        </span><span class="nt">&lt;user&gt;</span>RSSMRA85D18F051Y<span class="nt">&lt;/user&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sito&gt;</span>example<span class="nt">&lt;/id_sito&gt;</span>
<span class="w">        </span><span class="nt">&lt;esito_auth_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_aspnet_sa/&gt;</span>
<span class="w">        </span><span class="nt">&lt;url_validate&gt;</span>https://example.cohesion.it/Login<span class="nt">&lt;/url_validate&gt;</span>
<span class="w">        </span><span class="nt">&lt;url_richiesta&gt;</span>https://example.cohesion.it<span class="nt">&lt;/url_richiesta&gt;</span>
<span class="w">        </span><span class="nt">&lt;esito_auth_sso&gt;</span>OK<span class="nt">&lt;/esito_auth_sso&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_sso&gt;</span>A5D64899EBCEE1FA6B3E8FB3D3D358D7E5843EA25EDFD62277CACE8A5EF23B1C5E6FAB916F333B0AFB0FAE6C4CDF7B8E8DEE461E8661DB04F5FFB01BC0EF9FCB90EEA2ACA7988119EFE17D5C3BB58BC890D75D724D434D7D60C2F451F6A51D1DFFA900EF0AAA631A51458860C6CEC7B1EBC525561624208066DF276314F41F6EC258CA3F<span class="nt">&lt;/id_sessione_sso&gt;</span>
<span class="w">        </span><span class="nt">&lt;id_sessione_aspnet_sso&gt;</span>ufrq00x4f0cq2yog2ozv4lxx;https://idp.namirialtsp.com/idp;https://example.cohesion.it/LogOff;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;<span class="nt">&lt;/id_sessione_aspnet_sso&gt;</span>
<span class="w">        </span><span class="nt">&lt;stilesheet&gt;</span>AuthRestriction=1,2,3;https://example.cohesion.it/LogOff<span class="nt">&lt;/stilesheet&gt;</span>
<span class="w">        </span><span class="nt">&lt;ip</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>cohesion2.regione.marche.it<span class="nt">&lt;/ip&gt;</span>
<span class="w">        </span><span class="nt">&lt;AuthRestriction</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>1,2,3<span class="nt">&lt;/AuthRestriction&gt;</span>
<span class="w">        </span><span class="nt">&lt;UType</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>CD<span class="nt">&lt;/UType&gt;</span>
<span class="w">        </span><span class="nt">&lt;purpose</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;url_logout</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>https://example.cohesion.it/LogOff<span class="nt">&lt;/url_logout&gt;</span>
<span class="w">        </span><span class="nt">&lt;cittad</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/cittad&gt;</span>
<span class="w">    </span><span class="nt">&lt;/auth&gt;</span>
<span class="nt">&lt;/dsAuth&gt;</span>
</code></pre></div>

<p>Queste informazioni contengono solamente il codice fiscale dell'utente, ma non i suoi attributi.
Per ottenere gli attributi completi, è necessario effettuare una chiamata GET o POST all'indirizzo <a href="https://colab.research.google.com/corgiredirector?site=https%3A%2F%2Fcohesion2.regione.marche.it%2FSPManager%2FwebCheckSessionSSO.aspx">https://cohesion2.regione.marche.it/SPManager/webCheckSessionSSO.aspx</a> con i seguenti parametri:</p>
<div class="codehilite"><pre><span></span><code>Operation=GetCredential<span class="err">&amp;</span>IdSessioneSSO={id_sessione_sso}<span class="err">&amp;</span>IdSessioneASPNET={id_sessione_aspnet_sso}
</code></pre></div>

<p>Il token <em>SAML</em> restituito da Cohesion avrà la forma seguente:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;Signature</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;SignedInfo&gt;</span>
<span class="w">        </span><span class="nt">&lt;CanonicalizationMethod</span><span class="w"> </span><span class="na">Algorithm=</span><span class="s">&quot;http://www.w3.org/TR/2001/REC-xml-c14n-20010315&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;SignatureMethod</span><span class="w"> </span><span class="na">Algorithm=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Reference</span><span class="w"> </span><span class="na">URI=</span><span class="s">&quot;#SignedXmlId&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;DigestMethod</span><span class="w"> </span><span class="na">Algorithm=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;DigestValue&gt;</span>rNHSy/TcTBIweMerIO3jizVm7u0=<span class="nt">&lt;/DigestValue&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Reference&gt;</span>
<span class="w">    </span><span class="nt">&lt;/SignedInfo&gt;</span>
<span class="w">    </span><span class="nt">&lt;SignatureValue&gt;</span>
<span class="w">        </span>Oz9wACp9Rxo4Z4pC8o61iXuVSJNO+UcszPNcAMNFUAY0I17IeGnB93JpwEWGbPfqn5a+i3IQdNsqlIbQtwAGovBQ6DTTb85kDo4YDue26o7a4np5DfwnO6SuhHsBHMbTvnI9A+45Q7Li4On+eELEQWFRrbS11MmwRYBxR5m5PWKupkX3O2r9JtG6tuKwi/L5+A4U/MqLKDdUm9/TX1lzn5c23XpQgiYpkGrwRqp+Q1Dsem7FcV868VYvgwYkRkj/jNgLFtcdoFij+qBRZi47EUa35KeZgP5V1ENcYigG0OXQQbdavCnPcE3EHjEL3ApkuPNVuSbJZv5TjgFdCpqjXg==
<span class="w">    </span><span class="nt">&lt;/SignatureValue&gt;</span>
<span class="w">    </span><span class="nt">&lt;KeyInfo&gt;</span>
<span class="w">        </span><span class="nt">&lt;X509Data&gt;</span>
<span class="w">            </span><span class="nt">&lt;X509Certificate&gt;</span>
<span class="w">                </span>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
<span class="w">            </span><span class="nt">&lt;/X509Certificate&gt;</span>
<span class="w">        </span><span class="nt">&lt;/X509Data&gt;</span>
<span class="w">    </span><span class="nt">&lt;/KeyInfo&gt;</span>
<span class="w">    </span><span class="nt">&lt;Object</span><span class="w"> </span><span class="na">Id=</span><span class="s">&quot;SignedXmlId&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;profile</span><span class="w"> </span><span class="na">timestamp=</span><span class="s">&quot;Tue, 25 Jan 2022 22:02:49 GMT&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;base&gt;</span>
<span class="w">                </span><span class="nt">&lt;placeOfBirth&gt;</span>F051<span class="nt">&lt;/placeOfBirth&gt;</span>
<span class="w">                </span><span class="nt">&lt;localita_nascita&gt;</span>ROMA<span class="nt">&lt;/localita_nascita&gt;</span>
<span class="w">                </span><span class="nt">&lt;address&gt;</span>Via<span class="w"> </span>dei<span class="w"> </span>matti<span class="w"> </span>28<span class="w"> </span>60044<span class="w"> </span>ANCONA<span class="w"> </span>AN<span class="nt">&lt;/address&gt;</span>
<span class="w">                </span><span class="nt">&lt;indirizzo_residenza&gt;</span>Via<span class="w"> </span>dei<span class="w"> </span>matti<span class="w"> </span>28<span class="w"> </span>60044<span class="w"> </span>ANCONA<span class="w"> </span>AN<span class="nt">&lt;/indirizzo_residenza&gt;</span>
<span class="w">                </span><span class="nt">&lt;gender&gt;</span>M<span class="nt">&lt;/gender&gt;</span>
<span class="w">                </span><span class="nt">&lt;sesso&gt;</span>M<span class="nt">&lt;/sesso&gt;</span>
<span class="w">                </span><span class="nt">&lt;digitalAddress&gt;</span>xxxxxxxxxxx@pec.it<span class="nt">&lt;/digitalAddress&gt;</span>
<span class="w">                </span><span class="nt">&lt;email_certificata&gt;</span>xxxxxxxxxxx@pec.it<span class="nt">&lt;/email_certificata&gt;</span>
<span class="w">                </span><span class="nt">&lt;familyName&gt;</span>ROSSI<span class="nt">&lt;/familyName&gt;</span>
<span class="w">                </span><span class="nt">&lt;cognome&gt;</span>ROSSI<span class="nt">&lt;/cognome&gt;</span>
<span class="w">                </span><span class="nt">&lt;name&gt;</span>MARIO<span class="nt">&lt;/name&gt;</span>
<span class="w">                </span><span class="nt">&lt;nome&gt;</span>MARIO<span class="nt">&lt;/nome&gt;</span>
<span class="w">                </span><span class="nt">&lt;dateOfBirth&gt;</span>1985-04-18<span class="nt">&lt;/dateOfBirth&gt;</span>
<span class="w">                </span><span class="nt">&lt;data_nascita&gt;</span>18/04/1985<span class="nt">&lt;/data_nascita&gt;</span>
<span class="w">                </span><span class="nt">&lt;spidCode&gt;</span>NAMI0002653481<span class="nt">&lt;/spidCode&gt;</span>
<span class="w">                </span><span class="nt">&lt;countyOfBirth&gt;</span>RM<span class="nt">&lt;/countyOfBirth&gt;</span>
<span class="w">                </span><span class="nt">&lt;provincia_nascita&gt;</span>RM/provincia_nascita&gt;
<span class="w">                </span><span class="nt">&lt;fiscalNumber&gt;</span>TINIT-RSSMRA85D18F051Y<span class="nt">&lt;/fiscalNumber&gt;</span>
<span class="w">                </span><span class="nt">&lt;codice_fiscale&gt;</span>RSSMRA85D18F051Y<span class="nt">&lt;/codice_fiscale&gt;</span>
<span class="w">                </span><span class="nt">&lt;email&gt;</span>mario.rossi@regione.marche.it<span class="nt">&lt;/email&gt;</span>
<span class="w">                </span><span class="nt">&lt;companyFiscalNumber/&gt;</span>
<span class="w">                </span><span class="nt">&lt;tipo_autenticazione&gt;</span>PIN<span class="nt">&lt;/tipo_autenticazione&gt;</span>
<span class="w">                </span><span class="nt">&lt;login&gt;</span>RSSMRA85D18F051Y<span class="nt">&lt;/login&gt;</span>
<span class="w">                </span><span class="nt">&lt;samlResponseBase64&gt;</span>PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgi...<span class="nt">&lt;/samlResponseBase64&gt;</span>
<span class="w">            </span><span class="nt">&lt;/base&gt;</span>
<span class="w">        </span><span class="nt">&lt;/profile&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Object&gt;</span>
</code></pre></div>

<p>Gli attributi dell'utente sono contenuti nell'oggetto <em>Object</em>. Gli attributi restituiti possono variare in base all'Identity Provider, al livello di autenticazione e dalle impostazioni dell'utente.</p>
<p><strong>NOTA BENE</strong>: <em>Object</em> contiene anche il token SAML in <code>samlResponseBase64</code> il cui valore è quello della <em>SAMLResponse</em> originale restituita dall'Identity Provider scelto dall'utente.</p>
<h1 id="come-effettuare-il-logout">Come effettuare il logout?</h1>
<p>Per effettuare il <em>logout</em> basterà semplicemente chiamare lo stesso endpoint utilizzato per ottenere gli attributi dell'utente andando a modificare il parametro <strong>Operation</strong> e specificando <em>LogoutSito</em> invece di <em>GetCredential</em></p>
<p>Nel nostro esempio</p>
<div class="codehilite"><pre><span></span><code>https://cohesion2.regione.marche.it/SPManager/webCheckSessionSSO.aspx?Operation=LogoutSito<span class="ni">&amp;IdSessioneSSO=A5D64899EBCEE1FA6B3E8FB3D3D358D7E5843EA25EDFD62277CACE8A5EF23B1C5E6FAB916F333B0AFB0FAE6C4CDF7B8E8DEE461E8661DB04F5FFB01BC0EF9FCB90EEA2ACA7988119EFE17D5C3BB58BC890D75D724D434D7D60C2F451F6A51D1DFFA900EF0AAA631A51458860C6CEC7B1EBC525561624208066DF276314F41F6EC258CA3F&amp;IdSessioneASPNET=ufrq00x4f0cq2yog2ozv4lxx;</span>https://idp.namirialtsp.com/idp;https://q-marche.turitweb.it/LogOff;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;
</code></pre></div>


</section>

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../docs/_Footer.md"></script>
<script src="../docs/_Sidebar.md"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
</body>
</html>